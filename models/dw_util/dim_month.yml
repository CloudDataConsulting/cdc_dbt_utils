version: 2

models:
  - name: dim_month
    description: |
      Month dimension table containing one row per calendar month, derived from dim_date.
      Provides month-level aggregations and attributes for time series analysis at monthly granularity.
      Useful for financial reporting, trending, and month-over-month comparisons.

      Column naming follows CDC standards:
      - _dt for dates/timestamps
      - _num for numbers
      - _flg for boolean flags
      - _nm for names
      - _key for date keys in YYYYMMDD format
      - _txt for text strings
      - _abbr for abbreviations

    columns:
      # Primary key
      - name: month_key
        description: "Primary key as YYYYMM integer representing the year and month"
        data_tests:
          - unique
          - not_null

      # Month dates
      - name: month_begin_dt
        description: "First calendar date of the month"
        data_tests:
          - not_null

      - name: month_end_dt
        description: "Last calendar date of the month"
        data_tests:
          - not_null

      - name: month_begin_key
        description: "Date key (YYYYMMDD) of the month's first day"
        data_tests:
          - not_null

      - name: month_end_key
        description: "Date key (YYYYMMDD) of the month's last day"
        data_tests:
          - not_null

      # Standard calendar
      - name: year_num
        description: "Calendar year as 4-digit integer"
        data_tests:
          - not_null

      - name: quarter_num
        description: "Quarter number (1-4) containing this month"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [1, 2, 3, 4]

      - name: month_num
        description: "Month number within the year (1-12)"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]

      - name: month_nm
        description: "Full name of the month (January, February, etc.)"
        data_tests:
          - not_null

      - name: month_abbr
        description: "Three-letter abbreviation of the month (Jan, Feb, etc.)"
        data_tests:
          - not_null

      - name: month_in_quarter_num
        description: "Position of month within the quarter (1, 2, or 3)"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: [1, 2, 3]

      # Quarter information
      - name: quarter_txt
        description: "Quarter text (Q1, Q2, Q3, Q4)"
        data_tests:
          - not_null

      - name: quarter_nm
        description: "Quarter name (First, Second, Third, Fourth)"
        data_tests:
          - not_null

      # Month descriptions
      - name: month_year_nm
        description: "Month and year as text (e.g., 'January 2023')"
        data_tests:
          - not_null

      - name: month_year_abbr
        description: "Month abbreviation and year (e.g., 'Jan 2023')"
        data_tests:
          - not_null

      - name: year_month_txt
        description: "Year-month formatted as YYYY-MM string"
        data_tests:
          - not_null

      # Month metrics
      - name: days_in_month_num
        description: "Total number of days in the month (28-31)"
        data_tests:
          - not_null

      - name: weeks_in_month_num
        description: "Number of distinct weeks that overlap with this month"
        data_tests:
          - not_null

      # Trade/Retail calendar
      - name: trade_year_num
        description: "Trade/retail year (may differ from calendar year)"
        data_tests:
          - not_null

      - name: trade_month_num
        description: "Trade/retail month number"
        data_tests:
          - not_null

      - name: trade_quarter_num
        description: "Trade/retail quarter number"
        data_tests:
          - not_null

      # Position in year
      - name: month_of_year_num
        description: "Month number within the year (1-12), same as month_num"
        data_tests:
          - not_null

      - name: month_of_year_fiscal_num
        description: "Month number in fiscal year (can be customized for fiscal calendars)"
        data_tests:
          - not_null

      # Flags
      - name: current_month_flg
        description: "Flag indicating if this is the current month (1 = yes, 0 = no)"
        data_tests:
          - not_null

      - name: prior_month_flg
        description: "Flag indicating if this is the prior month (1 = yes, 0 = no)"
        data_tests:
          - not_null

      - name: current_year_flg
        description: "Flag indicating if this month is in the current year (1 = yes, 0 = no)"
        data_tests:
          - not_null

      - name: past_month_flg
        description: "Flag indicating if this month has ended (1 = yes, 0 = no)"
        data_tests:
          - not_null

      # Relative month numbers
      - name: months_ago_num
        description: "Number of months ago from current date (negative for future months)"
        data_tests:
          - not_null

      - name: months_from_now_num
        description: "Number of months from now (negative for past months)"
        data_tests:
          - not_null

      # Overall metrics
      - name: month_overall_num
        description: "Sequential month number since 1970-01-01, useful for month-over-month calculations"
        data_tests:
          - not_null

      - name: month_sort_num
        description: "Sorting helper calculated as year * 12 + month - 1"
        data_tests:
          - not_null

      # ETL metadata
      - name: create_user_id
        description: "User who created the record"
        data_tests:
          - not_null

      - name: create_ts
        description: "Timestamp when the record was created"
        data_tests:
          - not_null
